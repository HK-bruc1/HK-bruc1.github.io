# name: éƒ¨ç½²åˆ° Github Pages

# on:
  # push:  # å½“æœ‰æ¨é€æ“ä½œæ—¶è§¦å‘
    # branches: [main]  # åªåœ¨ master åˆ†æ”¯ä¸Šè§¦å‘
  # pull_request:  # å½“æœ‰æ‹‰å–è¯·æ±‚æ“ä½œæ—¶è§¦å‘
    # branches: [main]  # åªåœ¨ master åˆ†æ”¯ä¸Šè§¦å‘

# jobs:
  # build:  # æ„å»ºä»»åŠ¡
    # runs-on: ubuntu-latest  # åœ¨æœ€æ–°ç‰ˆçš„ Ubuntu ä¸Šè¿è¡Œ

    # permissions:
      # # ç»™é»˜è®¤çš„ GITHUB_TOKEN å†™æƒé™ï¼Œä»¥ä¾¿æäº¤å’Œæ¨é€æ·»åŠ æˆ–æ›´æ”¹çš„æ–‡ä»¶åˆ°ä»“åº“ã€‚
      # contents: write

    # steps:
      # - name: Checkout
        # uses: actions/checkout@v4.1.1 # æ£€å‡ºä»£ç 
        
      # - name: Cache Hugo resources  # ç¼“å­˜ Hugo èµ„æº
        # uses: actions/cache@v4.0.0
        # env:
          # cache-name: cache-hugo-resources
        # with:
          # path: resources  # ç¼“å­˜è·¯å¾„
          # key: ${{ env.cache-name }}  # ç¼“å­˜çš„é”®å€¼

      # - uses: actions/setup-go@v5.0.0  # è®¾ç½® Go ç¯å¢ƒ
        # with:
          # go-version: "^1.21.6"  # ä½¿ç”¨ Go 1.17.0 ç‰ˆæœ¬
      # - run: go version  # æ˜¾ç¤º Go ç‰ˆæœ¬ä»¥éªŒè¯å®‰è£…

      # - name: Setup Hugo  # é…ç½® Hugo
        # uses: peaceiris/actions-hugo@v2.6.0
        # with:
          # hugo-version: "0.122.0"  # ä½¿ç”¨æœ€æ–°ç‰ˆçš„ Hugo
          # extended: true  # ä½¿ç”¨æ‰©å±•ç‰ˆ Hugo

      # - name: Build  # æ„å»º
        # run: hugo --minify --gc  # æ‰§è¡Œ Hugo æ„å»ºå‘½ä»¤ï¼Œå¯ç”¨å‹ç¼©å’Œåƒåœ¾æ”¶é›†

      # - name: Deploy ğŸš€  # éƒ¨ç½²
        # uses: JamesIves/github-pages-deploy-action@v4.5.0
        # with:
          # branch: gh-pages  # éƒ¨ç½²åˆ° gh-pages åˆ†æ”¯
          # folder: public  # æŒ‡å®šéƒ¨ç½²çš„ç›®å½•
          # clean: true  # æ¸…ç†éƒ¨ç½²åˆ†æ”¯ï¼Œåªä¿ç•™æœ€æ–°çš„æäº¤
          # single-commit: true  # éƒ¨ç½²æ—¶åªåˆ›å»ºä¸€ä¸ªæäº¤
          
          
          
# å°† Hubo åšå®¢æ„å»ºåéƒ¨ç½²åˆ° Github Pages
name: Deploy github-pages

# åœ¨ master ä¸»å¹²åˆ†æ”¯çš„ä»»ä½• push äº‹ä»¶éƒ½ä¼šè§¦å‘æœ¬ DevOps å·¥ä½œæµæ°´çº¿
on:
  push:
    branches: [ main ]

# ä»¥ä¸‹æ˜¯æœ¬ä¸²è¡Œæ‰§è¡Œå·¥ä½œæµçš„æ‰€æœ‰ç»„æˆéƒ¨åˆ†
jobs:
  # è¿™é‡Œåªå®šä¹‰äº†ä¸€ä¸ªåä¸º "deploy" çš„å¤šæ­¥éª¤ä½œä¸š
  build-deploy-hugo-blog:
    # å°†åç»­çš„æ‰€æœ‰å·¥ä½œæ­¥éª¤éƒ½è¿è¡Œåœ¨æœ€æ–°ç‰ˆçš„ ubuntu æ“ä½œç³»ç»Ÿä¸Š
    runs-on: ubuntu-latest

    # æœ¬æ„å»ºå’Œéƒ¨ç½²ä½œä¸šçš„æ‰€æœ‰æ­¥éª¤å®šä¹‰å¦‚ä¸‹
    steps:

    # Step 1 - Checks-out ä½ çš„ä»£ç åº“åˆ° $GITHUB_WORKSPACE
    - name: Checkout blog code repo
      uses: actions/checkout@v2 # è¿™æ˜¯ Github å®˜æ–¹æä¾›çš„ä¸€ä¸ªåŠ¨ä½œæ¨¡å—
      with:
          submodules: true  # åŒæ­¥æ›´æ–°æ‰€ä½¿ç”¨çš„ Hugo æ¨¡æ¿
          fetch-depth: 0    # æ›´æ–°åˆ°è¯¥æ¨¡æ¿æœ€æ–°çš„ç‰ˆæœ¬

    # Step 2 - é…ç½®æœ€æ–°ç‰ˆæœ¬çš„ Hugo ç¯å¢ƒ
    - name: Setup Hugo
      uses: peaceiris/actions-hugo@v2  # è¿™æ˜¯ Github Actions å¸‚åœºä¸­çš„ä¸€ä¸ªåŠ¨ä½œæ¨¡å—
      with:
          hugo-version: 'latest'

    # Step 3 - æ¸…ç†ä»£ç åº“ä¸­ public ç›®å½•ä¸­çš„å†…å®¹
    - name: Clean public directory
      run: rm -rf public  # å½»åº•åˆ é™¤è¿™ä¸ªç›®å½•

    # Step 4 - ç”¨æœ€æ–°ç‰ˆæœ¬çš„ Hugo æ„å»ºä¸ªäººåšå®¢ç«™ç‚¹
    - name: Build blog site
      run: hugo --minify


    # Step 6 - å°†æ„å»ºå¥½çš„åšå®¢ç«™ç‚¹æ¨é€å‘å¸ƒåˆ° gh-pages åˆ†æ”¯
    - name: Deploy blog to Github-pages
      uses: peaceiris/actions-gh-pages@v3
      with:
          github_token: ${{ secrets.DEPLOY_KEY }}
          publish_dir: ./public