name: Deploy to Github Pages # å·¥ä½œæµçš„åç§°

on: # è§¦å‘æ¡ä»¶
  push: # å½“æœ‰pushæ“ä½œæ—¶è§¦å‘
    branches: [main] # åªé’ˆå¯¹masteråˆ†æ”¯
  pull_request: # å½“æœ‰pull requestæ“ä½œæ—¶è§¦å‘
    branches: [main] # åªé’ˆå¯¹masteråˆ†æ”¯

jobs:
  build: # æ„å»ºä»»åŠ¡
    runs-on: ubuntu-latest # è¿è¡Œç¯å¢ƒï¼Œæœ€æ–°çš„Ubuntuè™šæ‹Ÿæœº

    permissions:
      contents: write # ç»™é»˜è®¤çš„GITHUB_TOKENå†™æƒé™ï¼Œä»¥ä¾¿æäº¤å’Œæ¨é€æ·»åŠ æˆ–æ›´æ”¹çš„æ–‡ä»¶åˆ°ä»“åº“ã€‚

    steps:
      # - uses: actions/checkout@v4.1.1 # æ£€å‡ºä»£ç æ–°ç‰ˆä¸å¯ç”¨
      - name: Checkout
        uses: actions/checkout@v3
        with:
          submodules: true
      - uses: actions/cache@v4.0.0
        with:
            path: /home/runner/.cache/hugo_cache    # Linuxç³»ç»Ÿçš„Hugoæ¨¡å—ç¼“å­˜è·¯å¾„
            key: ${{ runner.os }}-hugomod-${{ hashFiles('**/go.sum') }}
            restore-keys: |
                ${{ runner.os }}-hugomod-

      - uses:  actions/setup-go@v5 # å®‰è£…Goè¯­è¨€ç¯å¢ƒ
        with:
            go-version:  '1.21.6'
            check-latest: false #ä¿æŒä¸æœ¬åœ°ç›¸åŒçš„é…ç½®
      - run: go version # æ˜¾ç¤ºGoç‰ˆæœ¬ä»¥éªŒè¯å®‰è£…

      - name: Clean public directory # æ–°å¢ï¼šæ¸…ç†publicç›®å½•çš„æ­¥éª¤
        run: rm -rf public

      - name: Setup Hugo # å®‰è£…Hugo
        uses: peaceiris/actions-hugo@v2.6.0
        with:
            hugo-version: '0.122.0' # æœ€æ–°ç‰ˆhugoæ”¯æŒgoçš„1.21.6
            extended: true # ä½¿ç”¨æ‰©å±•ç‰ˆHugo

      - name: Build # æ„å»ºç½‘ç«™
        run: hugo --minify --gc # æ‰§è¡ŒHugoæ„å»ºå‘½ä»¤ï¼Œå¯ç”¨å‹ç¼©å’Œåƒåœ¾æ”¶é›†

      - name: Deploy ğŸš€ # éƒ¨ç½²åˆ°GitHub Pages
        uses: JamesIves/github-pages-deploy-action@v4.5.0
        with:
            branch: gh-pages # éƒ¨ç½²åˆ°gh-pagesåˆ†æ”¯
            folder: public # æŒ‡å®šéƒ¨ç½²çš„ç›®å½•
            clean: true # æ¸…ç†éƒ¨ç½²åˆ†æ”¯ï¼Œåªä¿ç•™æœ€æ–°çš„æäº¤
            single-commit: true # éƒ¨ç½²æ—¶åªåˆ›å»ºä¸€ä¸ªæäº¤
